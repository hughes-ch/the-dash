#!/usr/bin/bash
DEPLOY_ENV=${GITHUB_REF##*/}
if [ -z "$DEPLOY_ENV" ]
then
  DEPLOY_ENV=dev
fi

echo Deploying to $DEPLOY_ENV

FUNC=the-dash-$DEPLOY_ENV-email-service
IMG=$FUNC:latest
REGION=us-east-1
REPO=176387286927.dkr.ecr.$REGION.amazonaws.com

docker tag $IMG $REPO/$IMG
docker push $REPO/$IMG

aws lambda update-function-code --region $REGION \
    --function-name $FUNC --image-uri $REPO/$IMG \
    --output text > /dev/null
